{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% if create %}Crear Usuario{% else %}Editar Usuario{% endif %}</title>
  <link rel="stylesheet" href="{% static 'CSS/historia_gerontologica.css' %}">
</head>
<body>
  <div class="container">
    <h1 class="main-title">{% if create %}Crear Usuario{% else %}Editar Usuario: {{ user_obj.username }}{% endif %}</h1>
    <div class="section-title">Información del usuario</div>
    {% if messages %}
      <div style="margin-bottom:12px;">
        {% for m in messages %}
          <div class="alert" style="padding:10px; border-radius:8px; background:#fdecea; color:#7f1d1d;">{{ m }}</div>
        {% endfor %}
      </div>
    {% endif %}
    <form method="post">
      {% csrf_token %}
      {% if create %}
        <div class="mb-3">
          <label class="form-label">Nombre de usuario</label>
          <input class="form-input" type="text" name="username" placeholder="correo@ejemplo.com" required value="{{ prefill.username|default:'' }}">
          {% if errors.username %}<div class="field-error">{{ errors.username }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Correo electrónico</label>
          <input class="form-input" type="email" name="email" placeholder="correo@ejemplo.com" value="{{ prefill.email|default:'' }}">
          {% if errors.email %}<div class="field-error">{{ errors.email }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Nombres</label>
          <input class="form-input" type="text" name="first_name" placeholder="Nombres" value="{{ prefill.first_name|default:'' }}">
          {% if errors.first_name %}<div class="field-error">{{ errors.first_name }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Apellidos</label>
          <input class="form-input" type="text" name="last_name" placeholder="Apellidos" value="{{ prefill.last_name|default:'' }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Teléfono</label>
          <input class="form-input" type="text" name="telefono" placeholder="(+57) 300 0000000" value="{{ prefill.telefono|default:'' }}">
          {% if errors.telefono %}<div class="field-error">{{ errors.telefono }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          <input class="form-input" type="password" name="password1" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Confirmar contraseña</label>
          <input class="form-input" type="password" name="password2" required>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_staff" name="is_staff">
          <label class="form-check-label" for="is_staff">Marcar como Personal (is_staff)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_superuser" name="is_superuser">
          <label class="form-check-label" for="is_superuser">Marcar como Superusuario</label>
        </div>
        <div class="mb-3 mt-2">
          <label for="profile" class="form-label">Perfil</label>
          <select id="profile" name="profile" class="form-input">
            <option value="">-- Selecciona un perfil --</option>
            {% for p in profiles %}
              <option value="{{ p }}">{{ p }}</option>
            {% endfor %}
          </select>
        </div>
      {% else %}
        <div class="mb-3">
          <label class="form-label">Nombre de usuario</label>
          <input class="form-input" type="text" name="username" value="{{ user_obj.username }}" required>
          {% if errors.username %}<div class="field-error">{{ errors.username }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Correo electrónico</label>
          <input class="form-input" type="email" name="email" value="{{ user_obj.email }}">
          {% if errors.email %}<div class="field-error">{{ errors.email }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Nombres</label>
          <input class="form-input" type="text" name="first_name" value="{{ user_obj.first_name }}">
          {% if errors.first_name %}<div class="field-error">{{ errors.first_name }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Apellidos</label>
          <input class="form-input" type="text" name="last_name" value="{{ user_obj.last_name }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Teléfono</label>
          <input class="form-input" type="text" name="telefono" value="{{ telefono }}">
          {% if errors.telefono %}<div class="field-error">{{ errors.telefono }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">Nueva contraseña</label>
          <input class="form-input" type="password" name="password" value="">
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_staff" name="is_staff" {% if user_obj.is_staff %}checked{% endif %}>
          <label class="form-check-label" for="is_staff">Marcar como Personal (is_staff)</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_superuser" name="is_superuser" {% if user_obj.is_superuser %}checked{% endif %}>
          <label class="form-check-label" for="is_superuser">Marcar como Superusuario</label>
        </div>
        <div class="mb-3 mt-2">
          <label for="profile" class="form-label">Perfil</label>
          <select id="profile" name="profile" class="form-input">
            <option value="">-- Selecciona un perfil --</option>
            {% for p in profiles %}
              <option value="{{ p }}" {% if current_group == p %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
          </select>
        </div>
      {% endif %}
      <div class="mt-3" style="display:flex; gap:12px; align-items:center;">
        <button class="submit-button" type="submit">Guardar</button>
        <a href="{% url 'admin_users' %}" class="submit-button submit-button--small submit-button--secondary" style="width:auto;">Cancelar</a>
      </div>
    </form>
  </div>
</body>
</html>
